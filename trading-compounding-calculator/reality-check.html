<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reality-Check Trading Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:sans-serif;background:#f6f8ff;margin:0;padding:20px;display:flex;justify-content:center}
#app{max-width:520px;width:100%;background:white;padding:25px;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,0.08)}
h2{margin-top:0}
label{display:block;margin-top:12px;font-weight:600}
input,select{width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;margin-top:4px}
.range-wrap{margin-top:4px}
button{width:100%;padding:12px;background:#1e63ff;color:white;border:none;font-size:17px;border-radius:6px;margin-top:20px;cursor:pointer}
button:hover{background:#003fe0}
.output{background:#eef4ff;padding:18px;margin-top:20px;border-radius:8px;display:none}
.red{color:#cf0000}
.green{color:#008f00}
.disclaimer{font-size:12px;margin-top:20px;color:#444}
</style>
</head>

<body>
<div id="app">
<h2>Reality-Check Trading Calculator</h2>
<p style="margin-top:-8px;font-size:13px;">Deterministic brokerage-aware compounding under SEBI peak-margin rules.</p>

<label>Starting Capital (₹)</label>
<input id="capital" value="₹1,00,000">
<input id="capRange" type="range" min="10000" max="10000000" value="100000">

<label>Trading Segment</label>
<select id="segment">
<option value="EQ">Equity – Intraday</option>
<option value="FO">F&O – Intraday</option>
</select>

<label>Trade Frequency</label>
<select id="frequency">
<option value="250">Daily (250 trades)</option>
<option value="50">Weekly (50 trades)</option>
<option value="12">Monthly (12 trades)</option>
</select>

<label>Average Profit per Trade (%)</label>
<input id="pPct" value="1">
<input id="pRange" type="range" min="0" max="20" step="0.1" value="1" class="range-wrap">

<label>Average Loss per Trade (%)</label>
<input id="lPct" value="1">
<input id="lRange" type="range" min="0" max="20" step="0.1" value="1" class="range-wrap">

<label>Win Rate (%)</label>
<input id="winRate" value="50">
<input id="winRange" type="range" min="0" max="100" step="1" value="50" class="range-wrap">

<label><input id="includeCharges" type="checkbox" checked> Include brokerage & statutory charges</label>
<label><input id="compound" type="checkbox" checked> Apply compounding</label>

<button onclick="runCalc()">Run Reality Check</button>

<div id="output" class="output">
<p id="finalCapital"></p>
<p id="netProfit"></p>
<p id="totalFees"></p>
<p id="verdict"></p>
</div>

<div class="disclaimer">
<b>Disclaimer:</b> Educational only. Trading is risky. Past performance doesn’t guarantee future results. 
Brokerage & tax logic approximated using SEBI guidelines and may vary between brokers.
</div>
</div>

<script>
function formatINR(n){return "₹"+Math.round(n).toLocaleString("en-IN");}
function parseINR(s){return parseFloat(s.replace(/[^0-9.]/g,""))||0;}

const cap=document.getElementById("capital"),capRange=document.getElementById("capRange");
capRange.oninput=()=>cap.value=formatINR(capRange.value);
cap.onblur=()=>{let v=parseINR(cap.value);v=Math.min(10000000,Math.max(10000,v));cap.value=formatINR(v);capRange.value=v};

["pPct","pRange"].forEach(id=>document.getElementById(id).oninput=()=>pPct.value=pRange.value=pPct.value);
["lPct","lRange"].forEach(id=>document.getElementById(id).oninput=()=>lPct.value=lRange.value=lPct.value);
["winRate","winRange"].forEach(id=>document.getElementById(id).oninput=()=>winRate.value=winRange.value=winRate.value);

function calcCharges(turn,pnl,seg){
  const BR=40;
  let stt=0,ex=0,sebi=0,gst=0,stamp=turn*0.00003;

  if(seg==="FO"){
    stt=pnl>0?pnl*0.001:0;
    ex=turn*0.0000173;
  } else {
    stt=pnl>0?pnl*0.00025:0;
    ex=turn*0.0000297;
  }
  sebi=turn*0.000001;
  let raw=BR+stt+ex+sebi;
  gst=raw*0.18;
  return BR+stt+ex+sebi+gst+stamp;
}

function runCalc(){
  const start=parseINR(cap.value);
  let bal=start;
  const trades=parseInt(frequency.value);
  const p=parseFloat(pPct.value)/100,l=parseFloat(lPct.value)/100,w=parseFloat(winRate.value)/100;
  const include=includeCharges.checked,compound=compound.checked,seg=segment.value;

  let wins=Math.round(trades*w),losses=trades-wins;
  let seq=[...Array(wins).fill(true),...Array(losses).fill(false)];

  let feeSum=0,fixedPL=0,fixedFee=0;

  seq.forEach(win=>{
    const change=win?p:-l;
    const base = compound?bal:start;
    const pnl=base*change;
    const turn=Math.abs(pnl)*100;
    const fee=include?calcCharges(turn,pnl,seg):0;

    if(compound){
      feeSum+=fee;
      bal+=pnl-fee;
    } else {
      fixedPL+=pnl;
      fixedFee+=fee;
    }
  });

  const final = compound ? bal : start + fixedPL - fixedFee;
  const net = final - start;
  const fees = compound ? feeSum : fixedFee;

  document.getElementById("finalCapital").textContent="Final Capital: "+formatINR(final);
  document.getElementById("netProfit").textContent="Net Profit: "+formatINR(net);
  document.getElementById("totalFees").textContent="Total Charges Paid: "+formatINR(fees);
  const verdictEl=document.getElementById("verdict");
  verdictEl.textContent = net>=0?"Verdict: Positive Expectancy":"Verdict: Negative Expectancy";
  verdictEl.className = net>=0?"green":"red";
  document.getElementById("output").style.display="block";
}
</script>

</body>
</html>
