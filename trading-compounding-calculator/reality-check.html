<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reality-Check Trading Calculator | CalcWorld</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial,sans-serif;background:#f6f7fb;margin:0}
header{background:#fff;padding:14px 24px;box-shadow:0 2px 4px rgba(0,0,0,.05)}
header a{text-decoration:none;color:#2563eb;font-size:20px;font-weight:bold}
.container{max-width:560px;margin:40px auto;background:#fff;padding:24px;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
h1{font-size:22px;margin-bottom:4px}
.sub{font-size:14px;color:#555;margin-bottom:18px}
label{display:block;font-size:14px;margin-top:14px}
input,select{width:100%;padding:10px;margin-top:6px;font-size:15px;border-radius:8px;border:1px solid #ccc}
input[type=range]{padding:0}
button{width:100%;margin-top:22px;padding:13px;font-size:16px;border:none;border-radius:10px;background:#2563eb;color:#fff;cursor:pointer}
.result{margin-top:24px;background:#f1f5ff;padding:18px;border-radius:12px}
.green{color:#16a34a;font-weight:bold}
.red{color:#dc2626;font-weight:bold}
.disclaimer{margin-top:20px;padding:12px;background:#fff7ed;border:1px solid #fed7aa;border-radius:8px;font-size:12px;color:#7c2d12}
</style>
</head>

<body>
<header><a href="/">CalcWorld</a></header>

<div class="container">
<h1>Reality-Check Trading Calculator</h1>
<p class="sub">Deterministic brokerage-aware compounding under SEBI peak-margin regime.</p>

<label>Starting Capital (₹)</label>
<input id="capitalDisplay" type="text" value="₹1,00,000">
<input id="capitalRange" type="range" min="10000" max="1000000" step="10000" value="100000">

<label>Trading Segment</label>
<select id="segment">
  <option value="delivery">Equity – Delivery</option>
  <option value="intraday">Equity – Intraday</option>
  <option value="fo">F&O – Intraday</option>
</select>

<label>Trade Frequency</label>
<select id="frequency">
  <option value="daily">Daily (250 trades)</option>
  <option value="weekly">Weekly (52 trades)</option>
  <option value="monthly">Monthly (12 trades)</option>
</select>

<label>Average Profit per Trade (%)</label>
<input id="profitPct" type="number" min="0" max="20" step="0.01" value="3">
<input id="profitRange" type="range" min="0" max="20" step="0.01" value="3">

<label>Average Loss per Trade (%)</label>
<input id="lossPct" type="number" min="0" max="20" step="0.01" value="1">
<input id="lossRange" type="range" min="0" max="20" step="0.01" value="1">

<label>Win Rate (%)</label>
<input id="winRate" type="number" min="0" max="100" step="1" value="60">
<input id="winRange" type="range" min="0" max="100" step="1" value="60">

<label style="margin-top:14px">
<input id="includeCharges" type="checkbox" checked> Include brokerage & statutory charges
</label>

<label style="margin-top:6px">
<input id="compounding" type="checkbox" checked> Apply compounding
</label>

<button onclick="runCalc()">Run Reality Check</button>

<div id="output" class="result" style="display:none"></div>

<div class="disclaimer">
<strong>Disclaimer:</strong> Educational only. Trading is risky. Past performance doesn’t guarantee future results.
Brokerage & tax logic approximated using SEBI guidelines and may vary between brokers.
</div>
</div>

<script>
const fmt = n=>"₹"+Math.round(n).toLocaleString("en-IN");

let capital=100000;
const capDisp=document.getElementById("capitalDisplay");
const capRange=document.getElementById("capitalRange");
capRange.oninput=()=>{capital=parseInt(capRange.value);capDisp.value=fmt(capital);};
capDisp.onblur=()=>{capital=Math.min(1000000,Math.max(10000,parseInt(capDisp.value.replace(/[^0-9]/g,""))||10000));capRange.value=capital;capDisp.value=fmt(capital);};

const bind=(a,b)=>{a.oninput=()=>b.value=a.value;b.oninput=()=>a.value=b.value};
bind(profitPct,profitRange);bind(lossPct,lossRange);bind(winRate,winRange);

function trades(freq){return freq==="daily"?250:freq==="weekly"?52:12;}

function charges(buy, sell, seg){
  const turnover = buy + sell;
  const brokerage = 40; // Groww flat

  let stt = 0, exch = 0, stamp = 0;

  if(seg==="delivery"){
    stt = sell * 0.001;
    exch = turnover * 0.0000297;
    stamp = buy * 0.00015;
  }
  else if(seg==="intraday"){
    stt = sell * 0.00025;
    exch = turnover * 0.0000297;
    stamp = buy * 0.00003;
  }
  else if(seg==="fo"){ 
    // OPTIONS PREMIUM (same as Groww)
    stt = sell * 0.001;           // 0.1%
    exch = turnover * 0.0003503;  // 0.03503%
    stamp = buy * 0.00003;        // 0.003%
  }

  const sebi = turnover * 0.000001;
  const gst = 0.18 * (brokerage + exch + sebi);

  return brokerage + stt + exch + sebi + stamp + gst;
}



function runCalc(){
  let cap = capital;
  let seg = segment.value;
  let t = trades(frequency.value);

  let p = profitPct.value/100;
  let l = lossPct.value/100;
  let w = winRate.value/100;

   // Safety limits
  if (p > 0.20) p = 0.20;
  if (l > 0.20) l = 0.20;
  if (w > 1)    w = 1;
  if (p < 0)    p = 0;
  if (l < 0)    l = 0;
  if (w < 0)    w = 0;

  // Reflect fixed values in UI
  profitPct.value = (p*100).toFixed(2);
  lossPct.value   = (l*100).toFixed(2);
  winRate.value   = Math.round(w*100);
  
  let inc = includeCharges.checked;
  let totalCharges = 0;

  // Decide wins & losses
  let wins = Math.round(t * w);
  let losses = t - wins;

// Build outcomes array
  let outcomes = [];
  for (let i=0; i<wins; i++) outcomes.push(true);
  for (let i=0; i<losses; i++) outcomes.push(false);

// Shuffle outcomes using Fisher–Yates
  for (let i = outcomes.length - 1; i > 0; i--) {
    let j = Math.floor(Math.random() * (i + 1));
    [outcomes[i], outcomes[j]] = [outcomes[j], outcomes[i]];
  }

// Main loop
  for (let i = 0; i < t; i++){
    const isWin = outcomes[i];

    const pnl = cap * (isWin ? p : -l);

    let buy = cap;
    let sell = cap + pnl; // only correct way to do turnover math

    let fee = inc ? charges(buy, sell, seg) : 0;

    cap = cap + pnl - fee;
    totalCharges += fee;

    if(cap <= 0 || isNaN(cap)){
      cap = 0;
      break;
    }
  }

  let net = cap - capital;
  let verdict = net > 0 ? "Positive Expectancy" : "Negative Expectancy";

  output.style.display="block";
  output.innerHTML = `
    <p><strong>Final Capital:</strong> ₹${Math.round(cap).toLocaleString("en-IN")}</p>
    <p><strong>Net Profit:</strong> <span class="${net>=0?'green':'red'}">₹${Math.round(net).toLocaleString("en-IN")}</span></p>
    <p><strong>Total Charges Paid:</strong> ₹${Math.round(totalCharges).toLocaleString("en-IN")}</p>
    <p><strong>Verdict:</strong> <span class="${net>=0?'green':'red'}">${verdict}</span></p>`;
}

</script>

</body>
</html>

