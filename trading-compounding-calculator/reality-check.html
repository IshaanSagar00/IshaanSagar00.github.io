<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reality-Check Trading Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:sans-serif;background:#f6f8ff;margin:0;padding:20px;display:flex;justify-content:center}
#app{max-width:520px;width:100%;background:white;padding:25px;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,0.08)}
h2{margin-top:0}
label{display:block;margin-top:12px;font-weight:600}
input,select{width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;margin-top:4px}
.range-wrap{margin-top:4px}
button{width:100%;padding:12px;background:#1e63ff;color:white;border:none;font-size:17px;border-radius:6px;margin-top:20px;cursor:pointer}
button:hover{background:#003fe0}
.output{background:#eef4ff;padding:18px;margin-top:20px;border-radius:8px;display:none}
.red{color:#cf0000}
.green{color:#008f00}
.disclaimer{font-size:12px;margin-top:20px;color:#444}
</style>
</head>

<body>
<div id="app">
<h2>Reality-Check Trading Calculator</h2>
<p style="margin-top:-8px;font-size:13px;">Deterministic brokerage-aware compounding under SEBI peak-margin rules.</p>

<label>Starting Capital (₹)</label>
<input id="capital" value="₹1,00,000">
<input id="capRange" type="range" min="10000" max="10000000" value="100000">

<label>Trading Segment</label>
<select id="segment">
<option value="EQ">Equity – Intraday</option>
<option value="FO">F&O – Intraday</option>
</select>

<label>Trade Frequency</label>
<select id="frequency">
<option value="250">Daily (250 trades)</option>
<option value="50">Weekly (50 trades)</option>
<option value="12">Monthly (12 trades)</option>
</select>

<label>Average Profit per Trade (%)</label>
<input id="pPct" value="1">
<input id="pRange" type="range" min="0" max="20" step="0.1" value="1" class="range-wrap">

<label>Average Loss per Trade (%)</label>
<input id="lPct" value="1">
<input id="lRange" type="range" min="0" max="20" step="0.1" value="1" class="range-wrap">

<label>Win Rate (%)</label>
<input id="winRate" value="50">
<input id="winRange" type="range" min="0" max="100" step="1" value="50" class="range-wrap">

<label><input id="includeCharges" type="checkbox" checked> Include brokerage & statutory charges</label>
<label><input id="compound" type="checkbox" checked> Apply compounding</label>

<button onclick="runCalc()">Run Reality Check</button>

<div id="output" class="output">
<p id="final"></p>
<p id="profit"></p>
<p id="fees"></p>
<p id="verdict"></p>
</div>

<div class="disclaimer">
<b>Disclaimer:</b> Educational only. Trading is risky. Past performance doesn’t guarantee future results. 
Brokerage & tax logic approximated using SEBI guidelines and may vary between brokers.
</div>

</div>

<script>
function formatINR(n){return "₹"+Math.round(n).toLocaleString("en-IN");}
function parseINR(s){return parseFloat(s.replace(/[^0-9.]/g,""))||0;}

const cap=document.getElementById("capital"),capRange=document.getElementById("capRange");
capRange.oninput=()=>cap.value=formatINR(capRange.value);
cap.onblur=()=>{let v=parseINR(cap.value);v=Math.min(10000000,Math.max(10000,v));cap.value=formatINR(v);capRange.value=v};

["pPct","pRange"].forEach(id=>document.getElementById(id).oninput=()=>pPct.value=pRange.value=pPct.value);
["lPct","lRange"].forEach(id=>document.getElementById(id).oninput=()=>lPct.value=lRange.value=lPct.value);
["winRate","winRange"].forEach(id=>document.getElementById(id).oninput=()=>winRate.value=winRange.value=winRate.value);

// Brokerage model (simplified but real structure)
function calcCharges(turnover,pnl,seg){
  const BR=40;  // per order both legs
  let stt=0,exch=0,sebi=0,gst=0,stamp=0;

  if(seg==="FO"){
    stt = pnl>0 ? pnl*0.001 : 0;              // 0.1% on profit
    exch = turnover*0.0000173;
  } else {
    stt = pnl>0 ? pnl*0.00025 : 0;            // 0.025%
    exch = turnover*0.0000297;
  }
  sebi = turnover*0.000001;
  stamp = turnover*0.00003;
  let raw = BR + stt + exch + sebi;
  gst = raw*0.18;
  return BR + stt + exch + sebi + gst + stamp;
}

function runCalc(){
  const start=parseINR(cap.value);
  let balance=start;
  const trades=parseInt(frequency.value);
  const p=parseFloat(pPct.value)/100;
  const l=parseFloat(lPct.value)/100;
  const w=parseFloat(winRate.value)/100;
  const include=includeCharges.checked;
  const compound=compound.checked;
  const seg=segment.value;

  let wins=Math.round(trades*w),losses=trades-wins;
  let outcomes=[...Array(wins).fill(true), ...Array(losses).fill(false)];

  let totalFees=0,fixedPnL=0,fixedFees=0;

  outcomes.forEach(win=>{
    const rate=win?p:-l;
    const base = compound ? balance : start;
    const pnl = base*rate;
    const turnover = Math.abs(base*rate)*100;
    const fee = include ? calcCharges(turnover,pnl,seg) : 0;

    if(compound){
      totalFees += fee;
      balance += pnl - fee;
    } else {
      fixedPnL += pnl;
      fixedFees += fee;
    }
  });

  const final = compound ? balance : start + fixedPnL - fixedFees;
  const fees = compound ? totalFees : fixedFees;
  const net = final - start;

  final.textContent="Final Capital: "+formatINR(final);
  profit.textContent="Net Profit: "+formatINR(net);
  feesEl.textContent="Total Charges Paid: "+formatINR(fees);
  verdict.textContent=(net>=0?"Verdict: Positive Expectancy":"Verdict: Negative Expectancy");
  verdict.className=(net>=0?"green":"red");
  output.style.display="block";
}

const final=document.getElementById("final");
const profit=document.getElementById("profit");
const feesEl=document.getElementById("fees");
const verdict=document.getElementById("verdict");
const output=document.getElementById("output");
</script>

</body>
</html>
