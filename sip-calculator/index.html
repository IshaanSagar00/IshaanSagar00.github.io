<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SIP & Lumpsum Calculator | CalcWorld</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{font-family:Arial,sans-serif;background:#f6f7f9;margin:0}
header{background:#fff;padding:16px 20px;box-shadow:0 2px 4px rgba(0,0,0,.05)}
main{max-width:420px;margin:30px auto;padding:0 16px}
.card{background:#fff;padding:20px;border-radius:16px;box-shadow:0 6px 20px rgba(0,0,0,.08)}

.tabs{display:flex;background:#eef2f7;border-radius:30px;padding:4px;margin-bottom:20px}
.tab{flex:1;text-align:center;padding:10px;border-radius:30px;font-weight:bold;cursor:pointer}
.tab.active{background:#2563eb;color:#fff}

.field{margin-bottom:18px}
.label{display:flex;justify-content:space-between;font-weight:bold;margin-bottom:6px}
.input-box{display:flex;align-items:center;gap:4px;background:#eafff6;padding:6px 8px;border-radius:6px}
.input-box input{border:none;background:transparent;width:100px;text-align:right;font-weight:bold;outline:none}

input[type=range]{width:100%}

.advanced{background:#f9fafb;padding:12px;border-radius:10px;margin-bottom:18px;display:none}

.results{margin-top:20px}
.result{display:flex;justify-content:space-between;font-weight:bold;margin-bottom:8px}

.compare{background:#eef2f7;padding:12px;border-radius:10px;margin-top:16px;display:none;font-size:14px}
.compare table{width:100%;border-collapse:collapse}
.compare th,.compare td{padding:6px;text-align:right}
.compare th:first-child,.compare td:first-child{text-align:left}
.compare thead{border-bottom:1px solid #d1d5db}
.advanced .field{
  margin-bottom:12px;
}
.advanced label{
  display:block;
  font-weight:bold;
  margin-bottom:4px;
}
.advanced select,
.advanced input{
  width:100%;
  padding:6px 8px;
  box-sizing:border-box;
}

canvas{max-width:220px;margin:20px auto 0;display:block}
</style>
</head>

<body>
<header><h2 style="margin:0">CalcWorld</h2></header>

<main>
<div class="card">

<div class="tabs">
  <div class="tab active" id="sipTab">SIP</div>
  <div class="tab" id="lumpTab">Lumpsum</div>
</div>

<!-- Amount -->
<div class="field">
  <div class="label">
    <span id="amountLabel">Monthly Investment</span>
    <div class="input-box">â‚¹ <input id="amountInput"></div>
  </div>
  <input type="range" id="amountRange">
</div>

<!-- SIP ADVANCED -->
<div class="field" id="sipToggleWrap">
  <label><input type="checkbox" id="sipStepToggle"> Increase SIP over time</label>
</div>

<div class="advanced" id="sipAdvanced">
  <label>Increase Type</label>
  <select id="sipStepType">
    <option value="fixed">Fixed (â‚¹)</option>
    <option value="percent">Percentage (%)</option>
  </select>

  <label>Increase Value</label>
  <input id="sipStepValue">

  <label>Increase Interval</label>
  <select id="sipStepInterval">
    <option value="6">Every 6 Months</option>
    <option value="12">Every 1 Year</option>
  </select>
</div>

<!-- LUMPSUM ADVANCED -->
<div class="field" id="lumpToggleWrap" style="display:none">
  <label><input type="checkbox" id="lumpRepeatToggle"> Add recurring lumpsum</label>
</div>

<div class="advanced" id="lumpAdvanced">
  <label>Frequency</label>
  <select id="lumpInterval">
    <option value="6">Every 6 Months</option>
    <option value="12">Every 1 Year</option>
  </select>
</div>

<!-- Return -->
<div class="field">
  <div class="label">
    <span>Expected Return</span>
    <div class="input-box"><input id="returnInput"> %</div>
  </div>
  <input type="range" id="returnRange" min="1" max="40" step="0.1">
</div>

<!-- Years -->
<div class="field">
  <div class="label">
    <span>Time Period</span>
    <div class="input-box"><input id="yearInput"> Yr</div>
  </div>
  <input type="range" id="yearRange" min="1" max="50">
</div>

<div class="results">
  <div class="result"><span>Total Invested</span><span id="invested">â‚¹0</span></div>
  <div class="result"><span>Estimated Returns</span><span id="returns">â‚¹0</span></div>
  <div class="result"><span>Maturity Value</span><span id="maturity">â‚¹0</span></div>
</div>

<div class="compare" id="compareBox">
<table>
<thead>
<tr>
<th></th>
<th>Without Increase</th>
<th>With Increase</th>
<th>Difference</th>
</tr>
</thead>
<tbody>
<tr><td>Total Invested</td><td id="cInvN"></td><td id="cInvA"></td><td id="cInvD"></td></tr>
<tr><td>Estimated Returns</td><td id="cRetN"></td><td id="cRetA"></td><td id="cRetD"></td></tr>
<tr><td>Maturity Value</td><td id="cMatN"></td><td id="cMatA"></td><td id="cMatD"></td></tr>
</tbody>
</table>
</div>

<canvas id="donutChart"></canvas>

</div>
</main>

<script>
const fmt=n=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(Math.round(n));
const clamp=(v,min,max)=>Math.min(Math.max(v,min),max);

let mode="sip";

const chart=new Chart(donutChart,{
type:"doughnut",
data:{labels:["Returns","Invested"],datasets:[{data:[0,0],backgroundColor:["#facc15","#2563eb"]}]}
});

function calculate(){
 let A = Number(amountInput.value);

if (isNaN(A)) {
  A = amountRange.min;
}

A = Math.min(Math.max(A, amountRange.min), amountRange.max);



  let r = clamp(clean(returnInput.value), 1, 40) / 100;
  let y = clamp(clean(yearInput.value), 1, 50);
  amountInput.value = A;
  amountRange.value = A;

  returnInput.value = (r * 100).toFixed(1);
  returnRange.value = r * 100;

  yearInput.value = y;
  yearRange.value = y;


  amountInput.value=A;
  amountRange.value=A;
  returnRange.value=r*100;
  yearRange.value=y;

  let rm=r/12, months=y*12;

  let investedN=0,maturityN=0;
  let investedA=0,maturityA=0;

  if(mode==="sip"){
    investedN=A*months;
    maturityN=A*((Math.pow(1+rm,months)-1)/rm)*(1+rm);

    let sip=A;
    for(let m=1;m<=months;m++){
      investedA+=sip;
      maturityA+=sip*Math.pow(1+rm,months-m);
      if(sipStepToggle.checked && m%sipStepInterval.value===0){
        sip+=sipStepType.value==="fixed"
          ? +sipStepValue.value||0
          : sip*(+sipStepValue.value||0)/100;
      }
    }
  }else{
    investedN=A;
    maturityN=A*Math.pow(1+r,y);

    investedA=investedN;
    maturityA=maturityN;

    if(lumpRepeatToggle.checked){
      for(let m=+lumpInterval.value;m<=months;m+=+lumpInterval.value){
        investedA+=A;
        maturityA+=A*Math.pow(1+rm,months-m);
      }
    }
  }

  invested.textContent=fmt(investedA);
  returns.textContent=fmt(maturityA-investedA);
  maturity.textContent=fmt(maturityA);

  chart.data.datasets[0].data=[maturityA-investedA,investedA];
  chart.update();

  const advOn=(mode==="sip"&&sipStepToggle.checked)||(mode==="lump"&&lumpRepeatToggle.checked);
  compareBox.style.display=advOn?"block":"none";

  if(advOn){
    cInvN.textContent=fmt(investedN);
    cInvA.textContent=fmt(investedA);
    cInvD.textContent=fmt(investedA-investedN);

    cRetN.textContent=fmt(maturityN-investedN);
    cRetA.textContent=fmt(maturityA-investedA);
    cRetD.textContent=fmt((maturityA-investedA)-(maturityN-investedN));

    cMatN.textContent=fmt(maturityN);
    cMatA.textContent=fmt(maturityA);
    cMatD.textContent=fmt(maturityA-maturityN);
  }
}

/* EVENTS */

[sipTab,lumpTab,amountInput,amountRange,returnInput,returnRange,yearInput,yearRange,
 sipStepToggle,sipStepType,sipStepValue,sipStepInterval,lumpRepeatToggle,lumpInterval]
.forEach(e => e && e.addEventListener("input", calculate));

/* SLIDER â†’ INPUT SYNC (KEEP ONLY ONE) */
amountRange.addEventListener("input", () => {
  amountInput.value = amountRange.value;
  calculate();
});
  amountInput.addEventListener("blur", () => {
  syncSliders();
  calculate();
});


returnRange.addEventListener("input", () => {
  returnInput.value = returnRange.value;
  calculate();
});

yearRange.addEventListener("input", () => {
  yearInput.value = yearRange.value;
  calculate();
});


sipTab.onclick=()=>{
  mode="sip";
  sipTab.classList.add("active");
  lumpTab.classList.remove("active");
  sipToggleWrap.style.display="block";
  lumpToggleWrap.style.display="none";
  lumpAdvanced.style.display="none";
  amountLabel.textContent="Monthly Investment";
  syncSliders();
  calculate();
};

lumpTab.onclick=()=>{
  mode="lump";
  lumpTab.classList.add("active");
  sipTab.classList.remove("active");
  sipToggleWrap.style.display="none";
  sipAdvanced.style.display="none";
  lumpToggleWrap.style.display="block";
  amountLabel.textContent="Investment Amount";
  syncSliders();
  calculate();
};


sipStepToggle.onchange=()=>sipAdvanced.style.display=sipStepToggle.checked?"block":"none";
lumpRepeatToggle.onchange=()=>lumpAdvanced.style.display=lumpRepeatToggle.checked?"block":"none";
function syncSliders(){
  if(mode==="sip"){
    amountRange.min = 100;
    amountRange.max = 1000000;     // 10,00,000
    amountRange.step = 100;
  }else{
    amountRange.min = 100;
    amountRange.max = 100000000;   // 10,00,00,000
    amountRange.step = 1000;
  }

  // ðŸ”‘ CRITICAL: keep slider value VALID
  let val = Number(amountInput.value) || amountRange.min;
  val = Math.min(Math.max(val, amountRange.min), amountRange.max);
  amountRange.value = val;
}


/* INIT */
amountInput.value=10000;
returnInput.value=12;
yearInput.value=10;
sipStepValue.value=5000;
syncSliders();
calculate();
</script>
</body>
</html>
