<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SIP & Lumpsum Calculator | CalcWorld</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{font-family:Arial,sans-serif;background:#f6f7f9;margin:0}
header{background:#fff;padding:16px 20px;box-shadow:0 2px 4px rgba(0,0,0,.05)}
main{max-width:420px;margin:30px auto;padding:0 16px}
.card{background:#fff;padding:20px;border-radius:16px;box-shadow:0 6px 20px rgba(0,0,0,.08)}

.tabs{display:flex;background:#eef2f7;border-radius:30px;padding:4px;margin-bottom:20px}
.tab{flex:1;text-align:center;padding:10px;border-radius:30px;font-weight:bold;cursor:pointer}
.tab.active{background:#2563eb;color:#fff}

.field{margin-bottom:18px}
.label{display:flex;justify-content:space-between;font-weight:bold;margin-bottom:6px}

.input-box{
  display:flex;align-items:center;gap:4px;
  background:#eafff6;padding:6px 8px;border-radius:6px
}
.input-box input{
  border:none;background:transparent;width:100px;
  text-align:right;font-weight:bold;outline:none
}

.error{
  font-size:12px;
  color:#dc2626;
  margin-top:4px;
  display:none;
}

input[type=range]{width:100%}

.advanced{
  background:#f9fafb;
  padding:12px;
  border-radius:10px;
  margin-bottom:20px;
  display:none;
}

.compare{
  background:#eef2f7;
  padding:12px;
  border-radius:10px;
  margin-top:20px;
  display:none;
  font-size:14px;
}

.results{margin-top:20px}
.result{display:flex;justify-content:space-between;margin-bottom:8px;font-weight:bold}

canvas{max-width:220px;margin:20px auto 0;display:block}
</style>
</head>

<body>

<header><h2>CalcWorld</h2></header>

<main>
<div class="card">

<div class="tabs">
  <div class="tab active" id="sipTab">SIP</div>
  <div class="tab" id="lumpTab">Lumpsum</div>
</div>

<!-- Amount -->
<div class="field">
  <div class="label">
    <span id="amountLabel">Monthly Investment</span>
    <div class="input-box">₹ <input id="amountInput"></div>
  </div>
  <input type="range" id="amountRange" min="100" max="100000" step="100">
  <div class="error" id="amountError"></div>
</div>

<!-- SIP Advance -->
<div class="field" id="sipToggleWrap">
  <label><input type="checkbox" id="sipStepToggle"> Increase SIP over time</label>
</div>

<div class="advanced" id="sipAdvanced">
  <div class="field">
    <label>Increase Type</label>
    <select id="sipStepType">
      <option value="fixed">Fixed (₹)</option>
      <option value="percent">Percentage (%)</option>
    </select>
  </div>

  <div class="field">
    <label>Increase Value</label>
    <input id="sipStepValue">
    <div class="error" id="sipStepError"></div>
  </div>

  <div class="field">
    <label>Increase Interval</label>
    <select id="sipStepInterval">
      <option value="6">Every 6 Months</option>
      <option value="12">Every 1 Year</option>
    </select>
  </div>
</div>

<!-- Return -->
<div class="field">
  <div class="label">
    <span>Expected Return</span>
    <div class="input-box"><input id="returnInput"> %</div>
  </div>
  <input type="range" id="returnRange" min="1" max="40" step="0.1">
  <div class="error" id="returnError"></div>
</div>

<!-- Years -->
<div class="field">
  <div class="label">
    <span>Time Period</span>
    <div class="input-box"><input id="yearInput"> Yr</div>
  </div>
  <input type="range" id="yearRange" min="1" max="50" step="1">
  <div class="error" id="yearError"></div>
</div>

<div class="results">
  <div class="result"><span>Total Invested</span><span id="invested">₹0</span></div>
  <div class="result"><span>Estimated Returns</span><span id="returns">₹0</span></div>
  <div class="result"><span>Maturity Value</span><span id="maturity">₹0</span></div>
</div>

<div class="compare" id="compareBox"></div>

<canvas id="donutChart"></canvas>

</div>
</main>

<script>
const fmt=n=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(Math.round(n));
const clean=v=>Number(String(v).replace(/[^0-9.]/g,""))||0;
const clamp=(v,min,max)=>Math.min(Math.max(v,min),max);

/* ===== LIMITS ===== */
const LIMITS={
  sipAmt:{min:100,max:10000000},
  lumpAmt:{min:100,max:100000000},
  rate:{min:1,max:100},
  years:{min:1,max:100},
  stepFixed:{min:1,max:100000},
  stepPct:{min:1,max:100}
};

let mode="sip";

/* Elements */
const amountInput=document.getElementById("amountInput");
const amountRange=document.getElementById("amountRange");
const returnInput=document.getElementById("returnInput");
const returnRange=document.getElementById("returnRange");
const yearInput=document.getElementById("yearInput");
const yearRange=document.getElementById("yearRange");

const sipStepToggle=document.getElementById("sipStepToggle");
const sipAdvanced=document.getElementById("sipAdvanced");
const sipStepType=document.getElementById("sipStepType");
const sipStepValue=document.getElementById("sipStepValue");
const sipStepInterval=document.getElementById("sipStepInterval");

const lumpRepeatToggle=document.getElementById("lumpRepeatToggle");
const lumpAdvanced=document.getElementById("lumpAdvanced");
const lumpInterval=document.getElementById("lumpInterval");

const investedEl=document.getElementById("invested");
const returnsEl=document.getElementById("returns");
const maturityEl=document.getElementById("maturity");

const cmpBox=document.getElementById("compareBox");
const cmpNormal=document.getElementById("cmpNormal");
const cmpAdvanced=document.getElementById("cmpAdvanced");
const cmpGain=document.getElementById("cmpGain");

const sipTab=document.getElementById("sipTab");
const lumpTab=document.getElementById("lumpTab");
const amountLabel=document.getElementById("amountLabel");

/* Chart */
const chart=new Chart(donutChart,{
  type:"doughnut",
  data:{labels:["Estimated Returns","Invested Amount"],datasets:[{data:[0,0],backgroundColor:["#facc15","#2563eb"]}]}
});

/* ===== BLOCK INVALID KEYS ===== */
[
  amountInput,returnInput,yearInput,sipStepValue
].forEach(el=>{
  el.addEventListener("keydown",e=>{
    if(["-","+","e","E"].includes(e.key)) e.preventDefault();
  });
});

/* ===== MODE ===== */
sipTab.onclick=()=>{
  mode="sip";
  sipTab.classList.add("active");
  lumpTab.classList.remove("active");
  document.getElementById("sipToggleWrap").style.display="block";
  document.getElementById("lumpToggleWrap").style.display="none";
  lumpAdvanced.style.display="none";
  amountLabel.textContent="Monthly Investment";
  calculate();
};

lumpTab.onclick=()=>{
  mode="lump";
  lumpTab.classList.add("active");
  sipTab.classList.remove("active");
  document.getElementById("sipToggleWrap").style.display="none";
  sipAdvanced.style.display="none";
  document.getElementById("lumpToggleWrap").style.display="block";
  amountLabel.textContent="Investment Amount";
  calculate();
};

/* ===== TOGGLES ===== */
sipStepToggle.onchange=()=>{
  sipAdvanced.style.display=sipStepToggle.checked?"block":"none";
  calculate();
};
lumpRepeatToggle.onchange=()=>{
  lumpAdvanced.style.display=lumpRepeatToggle.checked?"block":"none";
  calculate();
};

/* ===== INPUT SYNC ===== */
amountRange.oninput=()=>{
  amountInput.value=amountRange.value;
  calculate();
};
returnRange.oninput=()=>{
  returnInput.value=returnRange.value;
  calculate();
};
yearRange.oninput=()=>{
  yearInput.value=yearRange.value;
  calculate();
};

[sipStepType,sipStepInterval,lumpInterval].forEach(el=>el.oninput=calculate);
[sipStepValue].forEach(el=>el.oninput=calculate);

/* ===== VALIDATE ON BLUR ===== */
amountInput.onblur=()=>{
  const lim=mode==="sip"?LIMITS.sipAmt:LIMITS.lumpAmt;
  let v=clamp(clean(amountInput.value),lim.min,lim.max);
  amountInput.value=v.toLocaleString("en-IN");
  amountRange.value=Math.min(v,100000);
  calculate();
};

returnInput.onblur=()=>{
  let v=clamp(clean(returnInput.value),LIMITS.rate.min,LIMITS.rate.max);
  returnInput.value=v.toFixed(1);
  returnRange.value=Math.min(v,40);
  calculate();
};

yearInput.onblur=()=>{
  let v=clamp(clean(yearInput.value),LIMITS.years.min,LIMITS.years.max);
  yearInput.value=v;
  yearRange.value=Math.min(v,50);
  calculate();
};

sipStepValue.onblur=()=>{
  let v=clean(sipStepValue.value);
  v=sipStepType.value==="percent"
    ? clamp(v,LIMITS.stepPct.min,LIMITS.stepPct.max)
    : clamp(v,LIMITS.stepFixed.min,LIMITS.stepFixed.max);
  sipStepValue.value=v;
};

/* ===== CALCULATION (UNCHANGED) ===== */
function calculate(){
  const A=clean(amountInput.value);
  const r=clean(returnInput.value)/100;
  const y=clean(yearInput.value);
  const rm=r/12,months=y*12;

  let invested=0,maturity=0;
  let normalMaturity=0;

  if(mode==="sip"){
    const normalSip=A;
    normalMaturity=normalSip*((Math.pow(1+rm,months)-1)/rm)*(1+rm);

    let sip=A;
    for(let m=1;m<=months;m++){
      invested+=sip;
      maturity+=sip*Math.pow(1+rm,months-m);
      if(sipStepToggle.checked && m%Number(sipStepInterval.value)===0){
        sip+=sipStepType.value==="percent"
          ? sip*clean(sipStepValue.value)/100
          : clean(sipStepValue.value);
      }
    }

    cmpBox.style.display=sipStepToggle.checked?"block":"none";
    cmpNormal.textContent=fmt(normalMaturity);
    cmpAdvanced.textContent=fmt(maturity);
    cmpGain.textContent=fmt(maturity-normalMaturity);

  }else{
    invested=A;
    normalMaturity=A*Math.pow(1+r,y);
    maturity=normalMaturity;

    if(lumpRepeatToggle.checked){
      let recurInvested=A;
      let recurMaturity=normalMaturity;
      for(let m=Number(lumpInterval.value);m<=months;m+=Number(lumpInterval.value)){
        recurInvested+=A;
        recurMaturity+=A*Math.pow(1+rm,months-m);
      }
      invested=recurInvested;
      maturity=recurMaturity;
    }

    cmpBox.style.display=lumpRepeatToggle.checked?"block":"none";
    cmpNormal.textContent=fmt(normalMaturity);
    cmpAdvanced.textContent=fmt(maturity);
    cmpGain.textContent=fmt(maturity-normalMaturity);
  }

  investedEl.textContent=fmt(invested);
  returnsEl.textContent=fmt(maturity-invested);
  maturityEl.textContent=fmt(maturity);
  chart.data.datasets[0].data=[maturity-invested,invested];
  chart.update();
}

/* Init */
amountInput.value="10,000";
returnInput.value="12";
yearInput.value="10";
sipStepValue.value="5000";
calculate();
</script>


</body>
</html>
