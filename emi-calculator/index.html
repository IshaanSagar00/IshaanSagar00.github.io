<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EMI Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; background:#f4f6f8; }
.container {
  max-width:420px; margin:40px auto; background:#fff;
  padding:22px; border-radius:10px;
  box-shadow:0 4px 12px rgba(0,0,0,.1);
}
h1 { text-align:center; }
label { font-weight:bold; margin-top:14px; display:block; }
input, select {
  width:100%; padding:10px; margin-top:6px;
  border-radius:6px; border:1px solid #ccc;
}
button {
  width:100%; margin-top:18px; padding:12px;
  background:#2563eb; color:#fff; border:none;
  border-radius:6px; font-size:16px; cursor:pointer;
}
.small {
  font-size:13px; color:#2563eb; cursor:pointer;
  margin-top:12px; display:inline-block;
}
.box {
  margin-top:14px; padding:14px;
  border:1px solid #ddd; border-radius:6px;
}
.strategy {
  padding:10px; border:1px solid #ccc;
  border-radius:6px; margin-bottom:10px;
  cursor:pointer;
}
.strategy.active {
  border-color:#2563eb; background:#f1f5ff;
}
.result {
  margin-top:18px; background:#f1f5ff;
  padding:14px; border-radius:6px;
}
table {
  width:100%; border-collapse:collapse; margin-top:14px;
}
th, td {
  border:1px solid #ccc; padding:8px;
  font-size:14px; text-align:center;
}
th { background:#f0f0f0; }
.edu {
  margin-top:14px;
  background:#f9fafb;
  padding:14px;
  border-radius:6px;
  font-size:14px;
}
</style>
</head>

<body>
<div class="container">
<h1>EMI Calculator</h1>

<label>Loan Amount (₹)</label>
<input type="text" id="loan" placeholder="17,50,000">

<label>Interest Rate (% per year)</label>
<input type="number" id="rate">

<label>Loan Tenure (years)</label>
<input type="number" id="years">

<div class="small" onclick="toggleAdvanced()">▶ Advanced Prepayment Options</div>

<div id="advancedBox" class="box" style="display:none;">
  <b>Choose Strategy</b>

  <div class="strategy active" id="lumpBtn" onclick="setMode('lump')">
    Lump Sum Prepayment
  </div>

  <div class="strategy" id="emiBtn" onclick="setMode('emi')">
    EMI Increase Strategy
  </div>

  <div id="lumpFields">
    <label>Lump Sum Amount (₹)</label>
    <input type="number" id="lumpAmount">

    <label>Frequency</label>
    <select id="lumpFreq">
      <option value="1">One-time only</option>
      <option value="3">Every 3 months</option>
      <option value="6">Every 6 months</option>
      <option value="12">Every 12 months</option>
    </select>
  </div>

  <div id="emiFields" style="display:none;">
    <label>Increase Type</label>
    <select id="emiType">
      <option value="percent">Percentage (%)</option>
      <option value="amount">Fixed Amount (₹)</option>
    </select>

    <label>Increase Value</label>
    <input type="number" id="emiValue">

    <label>Frequency</label>
    <select id="emiFreq">
      <option value="1">One-time only</option>
      <option value="3">Every 3 months</option>
      <option value="6">Every 6 months</option>
      <option value="12">Every 12 months</option>
    </select>

    <label>Start Increase</label>
    <select id="emiStart">
      <option value="0">From Month 1</option>
      <option value="1">After 1 Frequency</option>
    </select>
  </div>

  <div class="edu">
    <b>How It Works</b><br><br>
    Extra EMI → Principal reduces faster → Less interest accrues → Tenure decreases
    <br><br>
    <b>Core Principle:</b><br>
    More principal today = Less interest tomorrow = Earlier freedom
  </div>
</div>

<button onclick="calculate()">Calculate</button>
<div id="output"></div>
</div>

<script>
let advanced = false;
let mode = "lump";

function toggleAdvanced(){
  advanced = !advanced;
  document.getElementById("advancedBox").style.display = advanced ? "block" : "none";
}

function setMode(m){
  mode = m;
  document.getElementById("lumpBtn").classList.toggle("active", m==="lump");
  document.getElementById("emiBtn").classList.toggle("active", m==="emi");
  document.getElementById("lumpFields").style.display = m==="lump" ? "block" : "none";
  document.getElementById("emiFields").style.display = m==="emi" ? "block" : "none";
}

function fmt(n){ return n.toLocaleString("en-IN"); }

document.getElementById("loan").addEventListener("input", e=>{
  let v = e.target.value.replace(/\D/g,'');
  e.target.value = v ? fmt(+v) : "";
});

function calculate(){
  const P = +loan.value.replace(/,/g,'');
  const r = +rate.value / 12 / 100;
  const N = +years.value * 12;

  if(!P || !r || !N){
    alert("Please fill all loan details");
    return;
  }

  const EMI = Math.round(P*r*Math.pow(1+r,N)/(Math.pow(1+r,N)-1));

  // NORMAL LOAN
  let bal = P, baseInterest = 0;
  for(let i=1;i<=N;i++){
    let interest = bal * r;
    baseInterest += interest;
    bal -= (EMI - interest);
  }
  const baseTotal = P + baseInterest;

  if(!advanced){
    output.innerHTML = `
      <div class="result">
        <b>Monthly EMI:</b> ₹${fmt(EMI)}<br>
        <b>Tenure:</b> ${N} months<br>
        <b>Total Interest:</b> ₹${fmt(Math.round(baseInterest))}<br>
        <b>Total Amount Paid:</b> ₹${fmt(Math.round(baseTotal))}
      </div>`;
    return;
  }

  // ADVANCED
  let bal2 = P, interest2 = 0, m = 0, curEMI = EMI;

  const lumpAmt = +lumpAmount.value || 0;
  const lumpFreq = +lumpFreq.value;

  const emiType = document.getElementById("emiType").value;
  const emiValue = +emiValue.value || 0;
  const emiFreq = +emiFreq.value;
  const emiStart = +emiStart.value;

  while(bal2 > 0 && m < 600){
    m++;

    if(mode === "lump" && lumpAmt > 0){
      if(lumpFreq === 1 && m === 1) bal2 -= lumpAmt;
      if(lumpFreq > 1 && m % lumpFreq === 0) bal2 -= lumpAmt;
    }

    if(mode === "emi" && emiValue > 0){
      let startMonth = emiStart === 0 ? 1 : emiFreq + 1;
      if(m >= startMonth){
        let t = m - startMonth;
        if((emiFreq === 1 && t === 0) || (emiFreq > 1 && t >= 0 && t % emiFreq === 0)){
          curEMI = emiType === "percent"
            ? Math.round(curEMI * (1 + emiValue / 100))
            : curEMI + emiValue;
        }
      }
    }

    let interest = bal2 * r;
    let principal = Math.min(curEMI - interest, bal2);
    interest2 += interest;
    bal2 -= principal;
  }

  const advTotal = P + interest2;

  output.innerHTML = `
  <table>
    <tr><th>Metric</th><th>Normal Loan</th><th>With Strategy</th><th>Advantage</th></tr>
    <tr><td>Loan Duration</td><td>${N} months</td><td>${m} months</td><td>${N-m} months faster</td></tr>
    <tr><td>Total Interest</td>
        <td>₹${fmt(Math.round(baseInterest))}</td>
        <td>₹${fmt(Math.round(interest2))}</td>
        <td>₹${fmt(Math.round(baseInterest-interest2))} saved</td></tr>
    <tr><td>Total Amount Paid</td>
        <td>₹${fmt(Math.round(baseTotal))}</td>
        <td>₹${fmt(Math.round(advTotal))}</td>
        <td>₹${fmt(Math.round(baseTotal-advTotal))} less</td></tr>
  </table>`;
}
</script>
</body>
</html>
