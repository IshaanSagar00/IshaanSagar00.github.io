<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Advanced EMI Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
}
.container {
  max-width:420px;
  margin:40px auto;
  background:#fff;
  padding:22px;
  border-radius:10px;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
}
h1 {
  text-align:center;
  margin-bottom:20px;
}
label {
  font-weight:bold;
  margin-top:14px;
  display:block;
}
input, select {
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:6px;
  border:1px solid #ccc;
}
button {
  width:100%;
  margin-top:20px;
  padding:12px;
  background:#2563eb;
  color:#fff;
  border:none;
  border-radius:6px;
  font-size:16px;
  cursor:pointer;
}
.small-link {
  font-size:13px;
  color:#2563eb;
  cursor:pointer;
  margin-top:12px;
  display:inline-block;
}
.box {
  margin-top:14px;
  padding:14px;
  border:1px solid #ddd;
  border-radius:6px;
}
.strategy {
  padding:10px;
  border:1px solid #ccc;
  border-radius:6px;
  margin-bottom:10px;
  cursor:pointer;
}
.strategy.active {
  border-color:#2563eb;
  background:#f1f5ff;
}
.result {
  margin-top:18px;
  background:#f1f5ff;
  padding:14px;
  border-radius:6px;
}
.dark-box {
  background:#111;
  color:#fff;
  padding:16px;
  border-radius:8px;
  margin-top:16px;
}
table {
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
}
th, td {
  border:1px solid #ccc;
  padding:8px;
  font-size:14px;
  text-align:center;
}
th {
  background:#f0f0f0;
}
</style>
</head>

<body>
<div class="container">
<h1>EMI Calculator</h1>

<label>Loan Amount (₹)</label>
<input type="text" id="loan" placeholder="e.g. 17,50,000">

<label>Interest Rate (% per year)</label>
<input type="number" id="rate" value="10">

<label>Loan Tenure (years)</label>
<input type="number" id="years" value="3">

<div class="small-link" onclick="toggleAdvanced()">▶ Advanced Prepayment Options (optional)</div>

<div id="advancedBox" class="box" style="display:none;">
  <b>Choose Strategy</b>

  <div class="strategy active" id="emiInc" onclick="selectStrategy('emi')">
    <b>Permanent EMI Increase</b><br>
    Increase EMI by % at fixed intervals
  </div>

  <label>Increase %</label>
  <input type="number" id="incPercent" value="10">

  <label>Frequency</label>
  <select id="frequency">
    <option value="3">Every 3 months</option>
    <option value="6" selected>Every 6 months</option>
    <option value="12">Every 12 months</option>
  </select>

  <label>Start Increasing EMI</label>
  <select id="startMode">
    <option value="0">From Month 1</option>
    <option value="1">After 1 Frequency</option>
  </select>
</div>

<button onclick="calculate()">Calculate EMI</button>

<div id="output"></div>
</div>

<script>
function formatINR(n){
  return n.toLocaleString("en-IN");
}

document.getElementById("loan").addEventListener("input", function(e){
  let v = e.target.value.replace(/,/g,'').replace(/\D/g,'');
  if(!v) return;
  e.target.value = formatINR(Number(v));
});

function toggleAdvanced(){
  let b = document.getElementById("advancedBox");
  b.style.display = b.style.display === "none" ? "block" : "none";
}

function calculate(){
  let P = Number(document.getElementById("loan").value.replace(/,/g,''));
  let r = Number(document.getElementById("rate").value)/12/100;
  let N = Number(document.getElementById("years").value)*12;

  if(!P || !r || !N){
    alert("Fill all values");
    return;
  }

  let EMI = (P*r*Math.pow(1+r,N))/(Math.pow(1+r,N)-1);
  EMI = Math.round(EMI);

  // baseline
  let bal = P;
  let interestBase = 0;
  for(let m=1;m<=N;m++){
    let i = bal*r;
    let p = EMI - i;
    interestBase += i;
    bal -= p;
  }

  // advanced
  let inc = Number(document.getElementById("incPercent").value)/100;
  let freq = Number(document.getElementById("frequency").value);
  let startMode = Number(document.getElementById("startMode").value);

  let bal2 = P;
  let interestAdv = 0;
  let curEMI = EMI;
  let baseEMI = EMI;
  let month = 0;

  while(bal2 > 0 && month < 600){
    month++;

    let eligibleMonth = startMode === 0 ? month : month - freq;
    if(eligibleMonth > 0 && eligibleMonth % freq === 0){
      let steps = Math.floor(eligibleMonth / freq);
      curEMI = Math.round(baseEMI * (1 + steps * inc));
    }

    let i = bal2*r;
    let p = curEMI - i;
    if(p > bal2) p = bal2;

    interestAdv += i;
    bal2 -= p;
  }

  let interestSaved = Math.round(interestBase - interestAdv);

  document.getElementById("output").innerHTML = `
  <div class="result">
    <b>Original EMI:</b> ₹${formatINR(EMI)}<br>
    <b>Original Tenure:</b> ${N} months<br>
    <b>Total Interest:</b> ₹${formatINR(Math.round(interestBase))}
    <hr>
    <b>New Tenure:</b> ${month} months<br>
    <b>Interest Saved:</b> ₹${formatINR(interestSaved)}
  </div>

  <table>
    <tr><th>Metric</th><th>Before</th><th>After</th><th>Saving</th></tr>
    <tr>
      <td>Tenure</td>
      <td>${N} mo</td>
      <td>${month} mo</td>
      <td>${N-month} mo</td>
    </tr>
    <tr>
      <td>Interest</td>
      <td>₹${formatINR(Math.round(interestBase))}</td>
      <td>₹${formatINR(Math.round(interestAdv))}</td>
      <td>₹${formatINR(interestSaved)}</td>
    </tr>
  </table>

  <div class="dark-box">
    <b>Why This Works</b><br><br>
    EMI increases accelerate principal reduction. Since interest is calculated
    only on remaining balance, lowering principal earlier sharply cuts total interest.
    <br><br>
    <b>Cash Flow Impact</b>
    <ul>
      <li>EMI rises gradually, not suddenly</li>
      <li>Loan ends ${N-month} months earlier</li>
      <li>EMI freed earlier for investing</li>
    </ul>
  </div>
  `;
}
</script>
</body>
</html>
