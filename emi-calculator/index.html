<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EMI Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
}
.container {
  max-width: 420px;
  margin: 40px auto;
  background: #fff;
  padding: 22px;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,.1);
}
h1 { text-align: center; }

label {
  display: block;
  margin-top: 14px;
  font-weight: bold;
}

input, select {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

button {
  width: 100%;
  margin-top: 18px;
  padding: 12px;
  background: #2563eb;
  color: #fff;
  border: none;
  border-radius: 6px;
  font-size: 16px;
  cursor: pointer;
}

.small {
  margin-top: 12px;
  font-size: 13px;
  color: #2563eb;
  cursor: pointer;
}

.box {
  margin-top: 14px;
  padding: 14px;
  border: 1px solid #ddd;
  border-radius: 6px;
}

.result {
  margin-top: 18px;
  background: #f1f5ff;
  padding: 14px;
  border-radius: 6px;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 14px;
}
th, td {
  border: 1px solid #ccc;
  padding: 8px;
  font-size: 14px;
  text-align: center;
}
th { background: #f0f0f0; }
</style>
</head>

<body>
<div class="container">
<h1>EMI Calculator</h1>

<label>Loan Amount (₹)</label>
<input type="text" id="loan" placeholder="17,50,000">

<label>Interest Rate (% per year)</label>
<input type="number" id="rate" placeholder="e.g. 10">

<label>Loan Tenure (years)</label>
<input type="number" id="years" placeholder="e.g. 3">

<div class="small" onclick="toggleAdvanced()">▶ Advanced EMI Increase</div>

<div id="advancedBox" class="box" style="display:none;">
  <label>Increase Type</label>
  <select id="incType">
    <option value="percent">Percentage (%)</option>
    <option value="amount">Fixed Amount (₹)</option>
  </select>

  <label>Increase Value</label>
  <input type="number" id="incValue" placeholder="e.g. 10 or 5000">

  <label>Frequency</label>
  <select id="freq">
    <option value="1">One-time</option>
    <option value="3">Every 3 months</option>
    <option value="6">Every 6 months</option>
    <option value="12">Every 12 months</option>
  </select>

  <label>Start Increase</label>
  <select id="start">
    <option value="0">From Month 1</option>
    <option value="1">After First Frequency</option>
  </select>

  <div class="result" style="background:#fafafa;">
    <b>How It Works</b><br><br>
    Extra EMI → Principal reduces faster → Less interest → Earlier closure
  </div>
</div>

<button onclick="calculate()">Calculate</button>
<div id="output"></div>
</div>

<script>
let advanced = false;

function toggleAdvanced() {
  advanced = !advanced;
  document.getElementById("advancedBox").style.display = advanced ? "block" : "none";
}

function formatINR(n) {
  return n.toLocaleString("en-IN");
}

document.getElementById("loan").addEventListener("input", e => {
  let v = e.target.value.replace(/\D/g,'');
  e.target.value = v ? formatINR(+v) : "";
});

function calculate() {
  const P = Number(loan.value.replace(/,/g,''));
  const annualRate = Number(rate.value);
  const yearsVal = Number(years.value);

  if (!P || !annualRate || !yearsVal) {
    alert("Please fill all loan fields");
    return;
  }

  const r = annualRate / 12 / 100;
  const N = yearsVal * 12;

  const EMI = P * r * Math.pow(1+r, N) / (Math.pow(1+r, N) - 1);

  // NORMAL LOAN
  let bal = P;
  let baseInterest = 0;
  for (let m = 1; m <= N; m++) {
    let interest = bal * r;
    baseInterest += interest;
    bal -= (EMI - interest);
  }
  const baseTotal = P + baseInterest;

  // NORMAL OUTPUT
  if (!advanced) {
    output.innerHTML = `
      <div class="result">
        <b>Monthly EMI:</b> ₹${formatINR(Math.round(EMI))}<br>
        <b>Tenure:</b> ${N} months<br>
        <b>Total Interest:</b> ₹${formatINR(Math.round(baseInterest))}<br>
        <b>Total Amount Paid:</b> ₹${formatINR(Math.round(baseTotal))}
      </div>`;
    return;
  }

  // ADVANCED EMI INCREASE
  const incType = incTypeSel = document.getElementById("incType").value;
  const incValue = Number(document.getElementById("incValue").value) || 0;
  const freqVal = Number(document.getElementById("freq").value);
  const startVal = Number(document.getElementById("start").value);

  let bal2 = P;
  let interest2 = 0;
  let curEMI = EMI;
  let month = 0;

  while (bal2 > 0 && month < 600) {
    month++;

    let startMonth = startVal === 0 ? 1 : freqVal + 1;
    if (month >= startMonth) {
      let t = month - startMonth;
      if (
        (freqVal === 1 && t === 0) ||
        (freqVal > 1 && t >= 0 && t % freqVal === 0)
      ) {
        curEMI = incType === "percent"
          ? curEMI * (1 + incValue / 100)
          : curEMI + incValue;
      }
    }

    let interest = bal2 * r;
    let principal = Math.min(curEMI - interest, bal2);
    interest2 += interest;
    bal2 -= principal;
  }

  const advTotal = P + interest2;

  output.innerHTML = `
  <table>
    <tr>
      <th>Metric</th>
      <th>Normal</th>
      <th>With EMI Increase</th>
      <th>Advantage</th>
    </tr>
    <tr>
      <td>Loan Duration</td>
      <td>${N} months</td>
      <td>${month} months</td>
      <td>${N - month} months faster</td>
    </tr>
    <tr>
      <td>Total Interest</td>
      <td>₹${formatINR(Math.round(baseInterest))}</td>
      <td>₹${formatINR(Math.round(interest2))}</td>
      <td>₹${formatINR(Math.round(baseInterest - interest2))} saved</td>
    </tr>
    <tr>
      <td>Total Amount Paid</td>
      <td>₹${formatINR(Math.round(baseTotal))}</td>
      <td>₹${formatINR(Math.round(advTotal))}</td>
      <td>₹${formatINR(Math.round(baseTotal - advTotal))} less</td>
    </tr>
  </table>`;
}
</script>
</body>
</html>
