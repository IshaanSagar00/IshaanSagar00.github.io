<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Advanced EMI Calculator – CalcWorld</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background:#f6f7f9;
  margin:0;
}

.container {
  max-width:460px;
  background:#fff;
  margin:40px auto;
  padding:24px;
  border-radius:10px;
  box-shadow:0 4px 12px rgba(0,0,0,.1);
}

h1 { text-align:center; margin-bottom:20px; }

label { font-weight:bold; display:block; margin-top:14px; }
input, select {
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:6px;
  border:1px solid #ccc;
}

button {
  width:100%;
  margin-top:18px;
  padding:12px;
  background:#2563eb;
  color:#fff;
  border:none;
  border-radius:6px;
  font-size:16px;
  cursor:pointer;
}

.small-link {
  font-size:13px;
  color:#2563eb;
  cursor:pointer;
  margin-top:10px;
  display:inline-block;
}

.card {
  background:#f1f5ff;
  padding:14px;
  border-radius:6px;
  margin-top:16px;
}

.hidden { display:none; }

.strategy {
  border:1px solid #ddd;
  padding:10px;
  border-radius:6px;
  margin-top:10px;
  cursor:pointer;
}

.strategy.active {
  border-color:#2563eb;
  background:#eef2ff;
}

table {
  width:100%;
  border-collapse:collapse;
  margin-top:14px;
  font-size:14px;
}

th, td {
  border:1px solid #ddd;
  padding:8px;
  text-align:left;
}

th {
  background:#f3f4f6;
}

.dark-section {
  background:#111;
  color:#e5e7eb;
  padding:18px;
  border-radius:8px;
  margin-top:18px;
}

.dark-section h3 { margin-top:0; }
.dark-section table { border-color:#333; }
.dark-section th { background:#1f1f1f; }
.dark-section td { border-color:#333; }
</style>
</head>

<body>

<div class="container">
<h1>EMI Calculator</h1>

<label>Loan Amount (₹)</label>
<input id="loan" placeholder="e.g. 17,50,000">

<label>Interest Rate (% per year)</label>
<input id="rate" type="number" placeholder="e.g. 10">

<label>Loan Tenure (years)</label>
<input id="tenure" type="number" placeholder="e.g. 3">

<div class="small-link" onclick="toggleAdvanced()">▶ Advanced Prepayment Options (optional)</div>

<div id="advanced" class="hidden">

<h4>Choose Strategy</h4>

<div class="strategy active" onclick="selectStrategy('lump')" id="lumpBox">
<strong>Lump Sum Prepayment</strong><br>
Pay fixed extra amount at intervals to reduce principal.
</div>

<div class="strategy" onclick="selectStrategy('increase')" id="increaseBox">
<strong>Permanent EMI Increase</strong><br>
Increase EMI permanently by ₹ or % at intervals.
</div>

<div id="lumpFields">
<label>Extra Amount (₹)</label>
<input id="lumpAmount" value="50000">

<label>Frequency</label>
<select id="lumpFreq">
<option value="3">Every 3 months</option>
<option value="6">Every 6 months</option>
<option value="12">Every 12 months</option>
</select>
</div>

<div id="increaseFields" class="hidden">
<label>Increase Type</label>
<select id="incType">
<option value="percent">Percentage (%)</option>
<option value="fixed">Fixed ₹</option>
</select>

<label>Increase Value</label>
<input id="incValue" value="10">

<label>Frequency</label>
<select id="incFreq">
<option value="6">Every 6 months</option>
<option value="12">Every 12 months</option>
</select>
</div>

</div>

<button onclick="calculate()">Calculate EMI</button>

<div id="result"></div>
</div>

<script>
const ₹ = n => "₹" + new Intl.NumberFormat("en-IN").format(Math.round(n));

document.getElementById("loan").addEventListener("input", e => {
  let v = e.target.value.replace(/,/g,'').replace(/\D/g,'');
  if(!v) return e.target.value='';
  let last3 = v.slice(-3);
  let other = v.slice(0,-3);
  if(other) last3 = ','+last3;
  e.target.value = other.replace(/\B(?=(\d{2})+(?!\d))/g, ",") + last3;
});

function toggleAdvanced() {
  document.getElementById("advanced").classList.toggle("hidden");
}

let strategy = "lump";

function selectStrategy(s) {
  strategy = s;
  document.getElementById("lumpBox").classList.toggle("active", s==="lump");
  document.getElementById("increaseBox").classList.toggle("active", s==="increase");
  document.getElementById("lumpFields").classList.toggle("hidden", s!=="lump");
  document.getElementById("increaseFields").classList.toggle("hidden", s!=="increase");
}

function calculate() {
  let P = Number(document.getElementById("loan").value.replace(/,/g,''));
  let rate = Number(document.getElementById("rate").value)/12/100;
  let N = Number(document.getElementById("tenure").value)*12;

  if(!P || !rate || !N) {
    result.innerHTML = "<div class='card'>Please enter all values.</div>";
    return;
  }

  let emi = (P*rate*Math.pow(1+rate,N))/(Math.pow(1+rate,N)-1);
  let baseTotal = emi*N;
  let baseInterest = baseTotal-P;

  if(!document.getElementById("advanced").classList.contains("hidden")) {
    if(strategy==="lump") {
      runLump(P, rate, emi, baseInterest);
    } else {
      runIncrease(P, rate, emi, baseInterest);
    }
  } else {
    result.innerHTML = `
    <div class="card">
      <strong>Monthly EMI:</strong> ${₹(emi)}<br>
      <strong>Tenure:</strong> ${N} months<br>
      <strong>Total Interest:</strong> ${₹(baseInterest)}
    </div>`;
  }
}

function runLump(P, R, EMI, baseInterest) {
  let extra = Number(lumpAmount.value);
  let freq = Number(lumpFreq.value);

  let bal=P, m=0, interest=0, extraPaid=0;

  while(bal>0 && m<1000) {
    m++;
    let i = bal*R;
    let p = EMI-i;
    bal-=p;
    interest+=i;

    if(m%freq===0 && bal>0) {
      let e = Math.min(extra, bal);
      bal-=e;
      extraPaid+=e;
    }
  }

  renderResult("Lump Sum Prepayment", EMI, m, interest, baseInterest, extraPaid);
}

function runIncrease(P, R, EMI, baseInterest) {
  let incType = incTypeSelect = incType.value;
  let incVal = Number(incValue.value);
  let freq = Number(incFreq.value);

  let bal=P, m=0, interest=0, curEMI=EMI;

  while(bal>0 && m<1000) {
    m++;
    if(m!==1 && (m-1)%freq===0) {
      curEMI = incType==="percent" ? curEMI*(1+incVal/100) : curEMI+incVal;
    }

    let i = bal*R;
    let p = curEMI-i;
    if(p>bal) p=bal;
    bal-=p;
    interest+=i;
  }

  renderResult("Permanent EMI Increase", curEMI, m, interest, baseInterest, null);
}

function renderResult(type, newEMI, months, newInterest, baseInterest, extraPaid) {
  let saved = baseInterest-newInterest;

  result.innerHTML = `
  <div class="card">
    <strong>Original EMI:</strong> ${₹(emi)}<br>
    <strong>Original Tenure:</strong> ${N} months<br>
    <strong>Total Interest:</strong> ${₹(baseInterest)}<hr>
    <strong>New Tenure:</strong> ${months} months<br>
    <strong>Interest Saved:</strong> ${₹(saved)}<br>
    ${extraPaid!==null?`<strong>Extra Paid:</strong> ${₹(extraPaid)}`:""}
  </div>

  <div class="dark-section">
    <h3>Why This Works</h3>
    <p>
      Extra payments directly reduce outstanding principal. Since interest is
      calculated only on remaining balance, reducing principal earlier cuts
      interest dramatically and shortens loan tenure.
    </p>

    <h3>Cash Flow Impact</h3>
    <ul>
      <li>Loan finishes earlier by ${N-months} months</li>
      <li>EMI obligation removed sooner</li>
      <li>Interest burden reduced significantly</li>
    </ul>
  </div>`;
}
</script>

</body>
</html>
