<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Advanced EMI Calculator | CalcWorld</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f6f7f9;margin:0}
.container{max-width:440px;background:#fff;margin:50px auto;padding:24px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.1)}
h1{text-align:center}
label{font-weight:bold;margin-top:14px;display:block}
input,select{width:100%;padding:10px;margin-top:6px;border:1px solid #ccc;border-radius:6px}
button{width:100%;padding:12px;margin-top:20px;background:#2563eb;color:#fff;border:none;border-radius:8px;font-size:16px;cursor:pointer}
button:hover{background:#1e4ed8}
.small{font-size:14px;color:#2563eb;cursor:pointer;margin-top:12px}
.box{border:1px solid #ddd;border-radius:8px;padding:12px;margin-top:12px}
.strategy{border:1px solid #ddd;padding:10px;border-radius:6px;margin-bottom:8px;cursor:pointer}
.strategy.active{border-color:#2563eb;background:#f1f5ff}
.result{background:#f1f5ff;padding:14px;border-radius:8px;margin-top:20px;font-size:15px}
table{width:100%;border-collapse:collapse;margin-top:14px;font-size:14px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
.dark{background:#111;color:#fff;padding:18px;border-radius:12px;margin-top:20px}
.dark h3{margin-top:0}
ul{padding-left:18px}
</style>
</head>

<body>
<div class="container">
<h1>EMI Calculator</h1>

<label>Loan Amount (₹)</label>
<input id="loan" placeholder="17,50,000">

<label>Interest Rate (% per year)</label>
<input id="rate" type="number" value="10">

<label>Loan Tenure (years)</label>
<input id="years" type="number" value="3">

<div class="small" onclick="toggleAdvanced()">▶ Advanced Prepayment Options (optional)</div>

<div id="advanced" style="display:none">

<div class="box">
<strong>Choose Strategy</strong>

<div class="strategy active" onclick="selectStrategy('lump')" id="lumpBox">
<strong>Lump Sum Prepayment</strong><br>
<small>Extra fixed amount paid periodically. EMI unchanged.</small>
</div>

<div class="strategy" onclick="selectStrategy('emi')" id="emiBox">
<strong>Permanent EMI Increase</strong><br>
<small>Increase EMI permanently by ₹ or %.</small>
</div>

<div id="lumpOptions">
<label>Extra Amount (₹)</label>
<input id="lumpAmount" value="50000">

<label>Frequency</label>
<select id="lumpFreq">
<option value="1">One-time</option>
<option value="3">Every 3 months</option>
<option value="6">Every 6 months</option>
<option value="12">Every 12 months</option>
</select>
</div>

<div id="emiOptions" style="display:none">
<label>Increase Type</label>
<select id="emiType">
<option value="percent">Percentage (%)</option>
<option value="rupee">Rupees (₹)</option>
</select>

<label>Increase Value</label>
<input id="emiValue" value="10">

<label>Frequency</label>
<select id="emiFreq">
<option value="1">One-time</option>
<option value="6">Every 6 months</option>
<option value="12">Every 12 months</option>
</select>
</div>
</div>
</div>

<button onclick="calculate()">Calculate EMI</button>

<div id="output"></div>
</div>

<script>
/* ---------- helpers ---------- */
const fmt = n => "₹"+new Intl.NumberFormat("en-IN").format(Math.round(n));
const parse = v => Number(v.replace(/,/g,""));

document.getElementById("loan").addEventListener("input",e=>{
let v=e.target.value.replace(/,/g,"").replace(/\D/g,"");
if(!v){e.target.value="";return;}
let l=v.slice(-3), r=v.slice(0,-3);
if(r) l=","+l, r=r.replace(/\B(?=(\d{2})+(?!\d))/g,",");
e.target.value=r+l;
});

/* ---------- UI ---------- */
let mode="lump";
function toggleAdvanced(){advanced.style.display=advanced.style.display==="none"?"block":"none"}
function selectStrategy(m){
mode=m;
lumpBox.classList.toggle("active",m==="lump");
emiBox.classList.toggle("active",m==="emi");
lumpOptions.style.display=m==="lump"?"block":"none";
emiOptions.style.display=m==="emi"?"block":"none";
}

/* ---------- core math ---------- */
function simulate(P, R, EMI, extraRule){
let bal=P, m=0, interest=0, extraPaid=0;
while(bal>0 && m<600){
m++;
let i=bal*R;
interest+=i;
bal+=i;
let pay=EMI;
if(extraRule) pay+=extraRule(m,EMI);
if(pay>bal) pay=bal;
bal-=pay;
extraPaid+=pay-EMI;
}
return {months:m, interest, extraPaid};
}

/* ---------- main ---------- */
function calculate(){
const P=parse(loan.value), r=rate.value/12/100, N=years.value*12;
const EMI=(P*r*Math.pow(1+r,N))/(Math.pow(1+r,N)-1);

/* original */
const base=simulate(P,r,EMI);

/* advanced */
let rule=null;
if(advanced.style.display==="block"){
if(mode==="lump"){
const amt=parse(lumpAmount.value), f=+lumpFreq.value;
rule=(m)=> (f===1 && m===1)||(f>1 && m%f===0)?amt:0;
}else{
let inc=+emiValue.value, f=+emiFreq.value;
let cur=EMI;
rule=(m)=>{
if(f===1 && m===1 || f>1 && m%f===0){
cur += (emiType.value==="percent") ? cur*(inc/100) : inc;
}
return cur-EMI;
};
}
}

const adv=simulate(P,r,EMI,rule);

let html=`
<div class="result">
<strong>Original EMI:</strong> ${fmt(EMI)}<br>
<strong>Original Tenure:</strong> ${base.months} months<br>
<strong>Total Interest:</strong> ${fmt(base.interest)}
<hr>
<strong>New Tenure:</strong> ${adv.months} months<br>
<strong>Interest Saved:</strong> ${fmt(base.interest-adv.interest)}<br>
<strong>Extra Paid:</strong> ${fmt(adv.extraPaid)}
</div>

<table>
<tr><th>Metric</th><th>Before</th><th>After</th><th>Saving</th></tr>
<tr><td>Tenure</td><td>${base.months} mo</td><td>${adv.months} mo</td><td>${base.months-adv.months} mo</td></tr>
<tr><td>Interest</td><td>${fmt(base.interest)}</td><td>${fmt(adv.interest)}</td><td>${fmt(base.interest-adv.interest)}</td></tr>
</table>

<div class="dark">
<h3>Why This Works</h3>
<p>Extra payments directly reduce principal. Since interest is calculated on the remaining balance, lowering principal early dramatically cuts future interest.</p>

<h3>Cash Flow Impact</h3>
<ul>
<li>EMI stays manageable</li>
<li>Loan ends earlier</li>
<li>Interest burden drops sharply</li>
<li>Monthly cash frees up sooner</li>
</ul>
</div>
`;

output.innerHTML=html;
}
</script>
</body>
</html>
