<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Monthly EMI Breakdown (Running Loan)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background:#f6f7fb;
  padding:20px;
}
.card {
  max-width:1100px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}
h1 { text-align:center; margin-top:0; }

.grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
}

label { font-weight:bold; font-size:14px; }
input, select {
  width:100%;
  padding:10px;
  margin-top:6px;
  font-size:14px;
}

button {
  margin-top:15px;
  padding:12px;
  font-size:16px;
  background:#2563eb;
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

.box {
  margin-top:20px;
  padding:16px;
  border:1px solid #ddd;
  border-radius:8px;
}

.hidden { display:none; }

table {
  width:100%;
  border-collapse:collapse;
  margin-top:25px;
  font-size:14px;
}
th, td {
  border:1px solid #ddd;
  padding:8px;
  text-align:right;
}
th {
  background:#f1f5f9;
}
th:first-child, td:first-child { text-align:left; }
tr.current {
  background:#e0f2fe;
  font-weight:bold;
}

.note {
  margin-top:15px;
  font-size:13px;
  color:#555;
  background:#fafafa;
  padding:10px;
  border-radius:6px;
}
</style>
</head>

<body>
<div class="card">
<h1>Monthly EMI Breakdown (Running Loan)</h1>

<div class="grid">
  <div>
    <label>Loan Amount (₹)</label>
    <input id="loan">
  </div>

  <div>
    <label>Interest Rate (% per year)</label>
    <input type="number" id="rate">
  </div>

  <div>
    <label>Remaining Tenure (months)</label>
    <input type="number" id="months">
  </div>

  <div>
    <label>EMI Start Month</label>
    <div style="display:flex;gap:6px;">
      <select id="startMonth"></select>
      <select id="startYear"></select>
    </div>
  </div>
</div>

<div class="box">
<b>Advanced Options</b>

<label style="margin-top:12px;">Strategy</label>
<select id="strategy">
  <option value="none">None</option>
  <option value="emi">EMI Increase</option>
  <option value="lump">Lump Sum</option>
</select>

<!-- EMI INCREASE -->
<div id="emiBox" class="hidden">
  <label>Increase Type</label>
  <select id="emiType">
    <option value="percent">Percentage (%)</option>
    <option value="amount">Fixed Amount (₹)</option>
  </select>

  <label>Increase Value</label>
  <input type="number" id="emiValue">

  <label>Frequency</label>
  <select id="emiFreq">
    <option value="once">One-time</option>
    <option value="3">Every 3 months</option>
    <option value="6">Every 6 months</option>
    <option value="12">Every 12 months</option>
  </select>

  <label>Start Increase</label>
  <select id="emiStartType">
    <option value="current">From Current Month</option>
    <option value="future">From Future Month</option>
  </select>

  <div id="emiFuture" class="hidden" style="display:flex;gap:6px;">
    <select id="emiStartMonth"></select>
    <select id="emiStartYear"></select>
  </div>
</div>

<!-- LUMP SUM -->
<div id="lumpBox" class="hidden">
  <label>Lump Sum Amount (₹)</label>
  <input type="number" id="lumpAmount">

  <label>Frequency</label>
  <select id="lumpFreq">
    <option value="once">One-time</option>
    <option value="3">Every 3 months</option>
    <option value="6">Every 6 months</option>
    <option value="12">Every 12 months</option>
  </select>

  <label>Start Month</label>
  <div style="display:flex;gap:6px;">
    <select id="lumpMonth"></select>
    <select id="lumpYear"></select>
  </div>
</div>
</div>

<button onclick="generate()">Generate Breakdown</button>

<div id="summary" class="box hidden"></div>
<div id="table"></div>

<div class="note">
Disclaimer: This calculator provides an approximate illustration.
Actual results may vary based on lender rules and rounding.
</div>

<footer style="margin-top:20px;text-align:center;font-size:13px;">
<a href="/emi-calculator/">← Back to EMI Calculator</a>
</footer>
</div>

<script>
const monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function fillMonthYear(mSel,ySel){
  mSel.innerHTML=monthNames.map((m,i)=>`<option value="${i}">${m}</option>`).join("");
  const y=new Date().getFullYear();
  ySel.innerHTML="";
  for(let i=y;i<=y+30;i++) ySel.innerHTML+=`<option>${i}</option>`;
}

fillMonthYear(startMonth,startYear);
fillMonthYear(emiStartMonth,emiStartYear);
fillMonthYear(lumpMonth,lumpYear);

strategy.onchange=()=>{
  emiBox.classList.toggle("hidden",strategy.value!=="emi");
  lumpBox.classList.toggle("hidden",strategy.value!=="lump");
};

emiStartType.onchange=()=>{
  emiFuture.classList.toggle("hidden",emiStartType.value!=="future");
};

function inr(n){return n.toLocaleString("en-IN");}

function generate(){
  const P=+loan.value.replace(/,/g,"");
  const r=+rate.value/12/100;
  const N=+months.value;

  if(!P||!r||!N){alert("Fill all fields");return;}

  const EMI=P*r*Math.pow(1+r,N)/(Math.pow(1+r,N)-1);

  let bal=P, balAdv=P;
  let baseInt=0, advInt=0;
  let curEMI=EMI;

  let date=new Date(startYear.value,startMonth.value,1);
  const today=new Date();
  const curKey=today.getFullYear()*12+today.getMonth();

  let emiStartKey=curKey;
  if(emiStartType.value==="future"){
    emiStartKey=emiStartYear.value*12+Number(emiStartMonth.value);
  }

  let lumpKey=lumpYear.value*12+Number(lumpMonth.value);

  let html=`<table>
  <tr><th>Month</th><th>EMI</th><th>Interest</th><th>Principal</th><th>Balance</th></tr>`;

  let advEnd=0;

  for(let m=1;m<=N;m++){
    const key=date.getFullYear()*12+date.getMonth();

    // NORMAL
    let i=bal*r;
    baseInt+=i;
    bal-=EMI-i;

    // EMI INCREASE
    if(strategy.value==="emi" && emiValue.value && key>=emiStartKey){
      if(emiFreq.value==="once" && key===emiStartKey ||
         emiFreq.value!=="once" && (key-emiStartKey)%emiFreq.value===0){
        curEMI=emiType.value==="percent"
          ?curEMI*(1+emiValue.value/100)
          :curEMI+Number(emiValue.value);
      }
    }

    // LUMP SUM
    if(strategy.value==="lump" && lumpAmount.value && key>=lumpKey){
      if(lumpFreq.value==="once" && key===lumpKey ||
         lumpFreq.value!=="once" && (key-lumpKey)%lumpFreq.value===0){
        balAdv-=Number(lumpAmount.value);
      }
    }

    let ai=balAdv*r;
    advInt+=ai;
    let principal=Math.min(curEMI-ai,balAdv);
    balAdv-=principal;
    if(balAdv<=0&&!advEnd) advEnd=m;

    const label=`${monthNames[date.getMonth()]} ${date.getFullYear()}`;
    const isCur=date.getMonth()===today.getMonth()&&date.getFullYear()===today.getFullYear();

    html+=`
    <tr class="${isCur?'current':''}">
      <td>${label}</td>
      <td>₹${inr(Math.round(principal+ai))}</td>
      <td>₹${inr(Math.round(ai))}</td>
      <td>₹${inr(Math.round(principal))}</td>
      <td>₹${inr(Math.max(0,Math.round(balAdv)))}</td>
    </tr>`;

    date.setMonth(date.getMonth()+1);
  }

  html+="</table>";
  table.innerHTML=html;

  const savedM=N-advEnd;
  const savedI=baseInt-advInt;

  summary.innerHTML=`
  <h3>Comparison Summary</h3>
  <p><b>Remaining Tenure:</b> ${N} → ${advEnd} months (${savedM} months saved)</p>
  <p><b>Remaining Interest:</b> ₹${inr(Math.round(baseInt))} → ₹${inr(Math.round(advInt))}</p>
  <p><b>Interest Saved:</b> ₹${inr(Math.round(savedI))}</p>`;
  summary.classList.remove("hidden");
}
</script>
</body>
</html>
