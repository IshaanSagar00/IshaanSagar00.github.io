<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SWP Calculator | CalcWorld</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family: Arial, sans-serif;
  background:#f3f6fb;
  margin:0;
  padding:20px;
}
.card{
  max-width:820px;
  margin:auto;
  background:#fff;
  padding:28px;
  border-radius:14px;
  box-shadow:0 15px 40px rgba(0,0,0,0.08);
}
h1{
  text-align:center;
  margin-bottom:25px;
}
.group{
  margin-bottom:20px;
}
label{
  font-weight:600;
  display:block;
  margin-bottom:6px;
}
input, select{
  width:100%;
  padding:10px;
  font-size:16px;
}
input[type="range"]{
  margin-top:6px;
}
.results{
  margin-top:30px;
  background:#f8fafc;
  padding:20px;
  border-radius:10px;
}
.results p{
  margin:8px 0;
  font-size:16px;
}
.status{
  margin-top:15px;
  padding:12px;
  border-radius:8px;
  font-weight:600;
}
.safe{
  background:#dcfce7;
  color:#166534;
}
.danger{
  background:#fee2e2;
  color:#991b1b;
}
@media(max-width:600px){
  .card{padding:20px}
}
</style>
</head>

<body>

<div class="card">
<h1>SWP Calculator</h1>

<div class="group">
<label>Total Investment (₹)</label>
<input type="text" id="investment" value="10,00,000">
<input type="range" id="investmentRange" min="0" max="100000000" step="10000" value="1000000">
</div>

<div class="group">
<label>Expected Annual Return (%)</label>
<input type="number" id="return" min="0" max="40" step="0.1" value="8">
</div>

<div class="group">
<label>Withdrawal Amount (₹)</label>
<input type="text" id="withdrawal" value="10,000">
<input type="range" id="withdrawalRange" min="0" step="1000">
</div>

<div class="group">
<label>Withdrawal Frequency</label>
<select id="frequency">
  <option value="12">Monthly</option>
  <option value="4">Quarterly</option>
  <option value="1">Yearly</option>
</select>
</div>

<div class="group">
<label>Time Period (Years)</label>
<input type="number" id="years" min="1" max="30" value="20">
</div>

<div class="results">
<p><strong>Total Withdrawn:</strong> ₹ <span id="totalWithdrawn">0</span></p>
<p><strong>Remaining Corpus:</strong> ₹ <span id="remaining">0</span></p>
<p><strong>Periods Sustained:</strong> <span id="periods">0</span></p>
<div id="status" class="status"></div>
</div>

</div>

<script>
const investmentInput = document.getElementById("investment");
const investmentRange = document.getElementById("investmentRange");
const withdrawalInput = document.getElementById("withdrawal");
const withdrawalRange = document.getElementById("withdrawalRange");

function parseINR(val){
  return Number(val.replace(/,/g,''));
}
function formatINR(num){
  return Math.round(num).toLocaleString("en-IN");
}

// sync investment
investmentRange.oninput = () => {
  investmentInput.value = formatINR(investmentRange.value);
  updateWithdrawalLimit();
  calculate();
};
investmentInput.onblur = () => {
  let v = Math.min(parseINR(investmentInput.value)||0,100000000);
  investmentRange.value = v;
  investmentInput.value = formatINR(v);
  updateWithdrawalLimit();
  calculate();
};

// withdrawal
withdrawalRange.oninput = () => {
  withdrawalInput.value = formatINR(withdrawalRange.value);
  calculate();
};
withdrawalInput.onblur = () => {
  let max = withdrawalRange.max;
  let v = Math.min(parseINR(withdrawalInput.value)||0,max);
  withdrawalRange.value = v;
  withdrawalInput.value = formatINR(v);
  calculate();
};

function updateWithdrawalLimit(){
  let invest = parseINR(investmentInput.value);
  let maxWithdraw = invest * 0.5;
  withdrawalRange.max = maxWithdraw;
  if(parseINR(withdrawalInput.value) > maxWithdraw){
    withdrawalRange.value = maxWithdraw;
    withdrawalInput.value = formatINR(maxWithdraw);
  }
}

document.querySelectorAll("input,select").forEach(el=>{
  el.oninput = calculate;
});

function calculate(){
  let principal = parseINR(investmentInput.value);
  let annualReturn = Number(document.getElementById("return").value);
  let withdraw = parseINR(withdrawalInput.value);
  let years = Number(document.getElementById("years").value);
  let freq = Number(document.getElementById("frequency").value);

  let periods = years * freq;
  let rate = annualReturn / 100 / freq;

  let balance = principal;
  let totalWithdrawn = 0;
  let completed = 0;

  for(let i=1;i<=periods;i++){
    balance += balance * rate;
    balance -= withdraw;
    if(balance <= 0){
      completed = i;
      break;
    }
    totalWithdrawn += withdraw;
    completed = i;
  }

  document.getElementById("totalWithdrawn").innerText = formatINR(totalWithdrawn);
  document.getElementById("remaining").innerText = formatINR(Math.max(balance,0));
  document.getElementById("periods").innerText = completed;

  const status = document.getElementById("status");
  if(balance <= 0){
    status.className = "status danger";
    status.innerText = "⚠️ Withdrawal too high. Corpus exhausted early.";
  } else {
    status.className = "status safe";
    status.innerText = "✅ Sustainable SWP. Corpus lasts full duration.";
  }
}

updateWithdrawalLimit();
calculate();
</script>

</body>
</html>
